var v=Object.defineProperty;var B=(r,t,e)=>t in r?v(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var n=(r,t,e)=>B(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const h of s.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=e(o);fetch(o.href,s)}})();const d=18,u=10;class m{constructor(t){n(this,"rowCounts",d);n(this,"columnCounts",u);n(this,"grid",[]);t?this.grid=t:this.grid=this.createEmptyGrid()}getGrid(){return this.grid}createEmptyGrid(){const t=[];for(let e=0;e<this.rowCounts;e++){const i=[];for(let o=0;o<this.columnCounts;o++)i.push(0);t.push(i)}return t}eraseBlock(t){const e=t.shape.length,i=t.shape[0].length;for(let o=0;o<e;o++)for(let s=0;s<i;s++)t.shape[o][s]!==0&&(this.grid[t.position.y-1+o][t.position.x-1+s]=0)}drawBlock(t){const e=t.shape.length,i=t.shape[0].length;for(let o=0;o<e;o++)for(let s=0;s<i;s++)t.shape[o][s]!==0&&(this.grid[t.position.y-1+o][t.position.x-1+s]=1)}clearRow(){for(let t=this.grid.length-1;t>0;t--)if(this.grid[t].reduce((e,i)=>e+i)===this.grid[0].length)for(;this.grid[t].reduce((e,i)=>e+i)===this.grid[0].length;){for(let e=t-1;e>=0;e--)this.grid[e+1]=this.grid[e];this.grid[0]=new Array(this.grid[0].length).fill(0)}}isEmptyCell({x:t,y:e}){return!(t<0||t>=this.grid[0].length||e<0||e>this.grid.length-1||this.grid[e][t]===1)}printGrid(){console.log(JSON.parse(JSON.stringify(this.grid)))}getDeepCopy(){const t=this.grid.map(e=>[...e]);return new m(t)}}class k{constructor(t){n(this,"service");this.service=t,this.handleKeyDown=this.handleKeyDown.bind(this),document.addEventListener("keydown",this.handleKeyDown)}handleKeyDown(t){if(!t.defaultPrevented)switch(t.key){case"ArrowLeft":this.service.moveBlockLeft(),this.service.map.printGrid();break;case"ArrowRight":this.service.moveBlockRight(),this.service.map.printGrid();break;case"ArrowDown":this.service.moveBlockDown(),this.service.map.printGrid();break;case"ArrowUp":this.service.rotateBlock(),this.service.map.printGrid();break;case" ":this.service.dropBlock(),this.service.map.printGrid();break}}}class f{constructor(t){n(this,"map");this.map=t}draw(){this.clearView(),this.colorView(),console.log("frame")}colorView(){const t=document.getElementsByClassName("cell");for(let e=0;e<this.map.grid.length;e++)for(let i=0;i<this.map.grid[0].length;i++)this.map.grid[e][i]!==0&&t[this.map.grid[0].length*e+i].classList.add("red")}clearView(){const t=document.getElementsByClassName("cell");for(let e=0;e<this.map.grid.length;e++)for(let i=0;i<this.map.grid[0].length;i++)t[this.map.grid[0].length*e+i].classList.remove("red")}}class l{static detectCollisionOnLeft(t,e){const{mapCopy:i,tetrisBlockCopy:o}=this.getDeepCopy(t,e);i.eraseBlock(o),o.moveLeft();const s=o.getCells();return this.checkCollision(s,i)}static detectCollisionOnRight(t,e){const{mapCopy:i,tetrisBlockCopy:o}=this.getDeepCopy(t,e);i.eraseBlock(e),o.moveRight();const s=o.getCells();return this.checkCollision(s,i)}static detectCollisionOnBottom(t,e){const{mapCopy:i,tetrisBlockCopy:o}=this.getDeepCopy(t,e);i.eraseBlock(e),o.moveDown();const s=o.getCells();return this.checkCollision(s,i)}static detectCollisionOnRotation(t,e){const{mapCopy:i,tetrisBlockCopy:o}=this.getDeepCopy(t,e);i.eraseBlock(e),o.rotate();const s=o.getCells();return this.checkCollision(s,i)}static detectCollisionOnStart(t,e){return this.checkCollision(e.getCells(),t)}static getDeepCopy(t,e){const i=t.getDeepCopy(),o=e.getDeepCopy();return{mapCopy:i,tetrisBlockCopy:o}}static checkCollision(t,e){let i=!1;return t.forEach(o=>{i||e.isEmptyCell(o)||(i=!0)}),i}}class c{constructor(t,e,i){n(this,"shape");n(this,"position");n(this,"color");if(t.length!==t[0].length)throw Error("only sqaure matrix");this.shape=t,this.position=e,this.color=i}getDeepCopy(){const t=this.shape.map(i=>[...i]),e={...this.position};return new c(t,e,this.color)}getCells(){const t=[];for(let e=0;e<this.shape.length;e++)for(let i=0;i<this.shape[0].length;i++)this.shape[e][i]!==0&&t.push({x:this.position.x-1+i,y:this.position.y-1+e});return t}rotate(){const t=[];for(let e=0;e<this.shape.length;e++){const i=[];for(let o=this.shape[0].length-1;o>=0;o--)i.push(this.shape[o][e]);t.push(i)}this.shape=t}moveUp(){this.position={...this.position,y:this.position.y+-1}}moveDown(){this.position={...this.position,y:this.position.y+1}}moveRight(){this.position={...this.position,x:this.position.x+1}}moveLeft(){this.position={...this.position,x:this.position.x-1}}print(){console.log(this)}getHeight(){return this.shape.length}getWidth(){return this.shape[0].length}}class w{static getNewBlock(){return Math.floor(Math.random()*10)<4?this.getTBlock():this.getLBlock()}static getTBlock(){return new c([[0,1,0],[1,1,1],[0,0,0]],{x:4,y:2},"red")}static getLBlock(){return new c([[0,1,0],[0,1,0],[0,1,1]],{x:4,y:2},"red")}}class C{constructor(t){n(this,"map");n(this,"tetrisBlocks");n(this,"movingTetrisBlock");n(this,"fallingDownInterval");n(this,"isHitBottom",!1);this.map=t,this.movingTetrisBlock=this.getNewTetrisBlock(),this.tetrisBlocks=[...new Array(3)].map(e=>this.getNewTetrisBlock()),this.map.drawBlock(this.movingTetrisBlock),this.fallingDownInterval=this.getFallingDownInterval()}dropBlock(){for(;!l.detectCollisionOnBottom(this.map,this.movingTetrisBlock);)this.moveBlockDown();this.next()}moveBlockLeft(){l.detectCollisionOnLeft(this.map,this.movingTetrisBlock)||(this.map.eraseBlock(this.movingTetrisBlock),this.movingTetrisBlock.moveLeft(),this.map.drawBlock(this.movingTetrisBlock))}moveBlockRight(){l.detectCollisionOnRight(this.map,this.movingTetrisBlock)||(this.map.eraseBlock(this.movingTetrisBlock),this.movingTetrisBlock.moveRight(),this.map.drawBlock(this.movingTetrisBlock))}moveBlockDown(){l.detectCollisionOnBottom(this.map,this.movingTetrisBlock)||(this.map.eraseBlock(this.movingTetrisBlock),this.movingTetrisBlock.moveDown(),this.map.drawBlock(this.movingTetrisBlock))}rotateBlock(){if(this.map.eraseBlock(this.movingTetrisBlock),!l.detectCollisionOnRotation(this.map,this.movingTetrisBlock)){this.movingTetrisBlock.rotate(),this.map.drawBlock(this.movingTetrisBlock);return}let t=this.movingTetrisBlock.getDeepCopy();if(t.moveRight(),t.rotate(),!l.checkCollision(t.getCells(),this.map)){this.movingTetrisBlock.moveRight(),this.movingTetrisBlock.rotate(),this.map.drawBlock(this.movingTetrisBlock);return}if(t=this.movingTetrisBlock.getDeepCopy(),t.moveLeft(),t.rotate(),!l.checkCollision(t.getCells(),this.map)){this.movingTetrisBlock.moveLeft(),this.movingTetrisBlock.rotate(),this.map.drawBlock(this.movingTetrisBlock);return}if(t=this.movingTetrisBlock.getDeepCopy(),t.moveLeft(),t.moveUp(),t.rotate(),!l.checkCollision(t.getCells(),this.map)){this.movingTetrisBlock.moveLeft(),this.movingTetrisBlock.moveUp(),this.movingTetrisBlock.rotate(),this.map.drawBlock(this.movingTetrisBlock);return}if(t=this.movingTetrisBlock.getDeepCopy(),t.moveRight(),t.moveUp(),t.rotate(),!l.checkCollision(t.getCells(),this.map)){this.movingTetrisBlock.moveRight(),this.movingTetrisBlock.moveUp(),this.movingTetrisBlock.rotate(),this.map.drawBlock(this.movingTetrisBlock);return}this.map.drawBlock(this.movingTetrisBlock)}getNewTetrisBlock(){return w.getNewBlock()}clearFallingDownInterval(){this.isHitBottom=!1,clearInterval(this.fallingDownInterval)}getFallingDownInterval(){return setInterval(()=>{if(this.moveBlockDown(),l.detectCollisionOnBottom(this.map,this.movingTetrisBlock)){this.isHitBottom&&this.next(),console.log("다내려왔거등"),this.isHitBottom=!0;return}this.isHitBottom=!1},1e3)}next(){if(this.clearFallingDownInterval(),this.map.clearRow(),this.setNextBlock(),l.detectCollisionOnStart(this.map,this.movingTetrisBlock)){this.lose();return}this.map.drawBlock(this.movingTetrisBlock),this.fallingDownInterval=this.getFallingDownInterval()}setNextBlock(){const t=this.tetrisBlocks.shift();if(!t)throw Error("there is no next block");this.tetrisBlocks.push(this.getNewTetrisBlock()),this.movingTetrisBlock=t}lose(){this.clearFallingDownInterval()}}function y(r){const t=document.getElementById("gameBackground");[...new Array(r)].map(e=>{const i=document.createElement("div");i.classList.add("star"),i.style.left=`${Math.random()*100}%`,i.style.top=`${Math.random()*100}%`,i.style.animationDelay=`${Math.random()*2}s`,t==null||t.appendChild(i)})}function T(r,t){const e=document.getElementById("gameGUI");document.createElement("div").classList.add("cell"),[...new Array(r*t)].map(o=>{const s=document.createElement("div");s.classList.add("cell"),e==null||e.appendChild(s)})}let p,a,g;function D(){a=new m,p=new C(a),new k(p),g=new f(a),setInterval(()=>{g.draw()},16)}y(100);T(d,u);const L=()=>{D();const r=document.getElementById("startBtn");r&&(r.style.visibility="hidden")};function O(){const r=document.getElementById("gameGUI"),t=document.createElement("button");t.id="startBtn",t.innerText="start",t.classList.add("button"),t.addEventListener("click",L),r==null||r.appendChild(t)}O();
